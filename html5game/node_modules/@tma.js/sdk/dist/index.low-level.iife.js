var Qe=Object.defineProperty;var xe=(i,f,l)=>f in i?Qe(i,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[f]=l;var S=(i,f,l)=>(xe(i,typeof f!="symbol"?f+"":f,l),l);this.tmajs=this.tmajs||{};this.tmajs.sdk=function(i){"use strict";function f(e,t){let r;const n=()=>{r!==void 0&&t&&t(r),r=void 0};return[()=>r===void 0?r=e(n):r,n]}function l(e){const t=T(),{count:r}=t;t.unsubscribe(e),r&&!t.count&&Pe()}function L(e){return T().subscribe(e),()=>l(e)}class ne{constructor(t,r={}){this.scope=t,this.options=r}print(t,...r){const n=new Date,o=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(n),{textColor:s,bgColor:u}=this.options,c="font-weight: bold;padding: 0 5px;border-radius:5px";console[t](`%c${o}%c / %c${this.scope}`,`${c};background-color: lightblue;color:black`,"",`${c};${s?`color:${s};`:""}${u?`background-color:${u}`:""}`,...r)}error(...t){this.print("error",...t)}log(...t){this.print("log",...t)}}const A=new ne("SDK",{bgColor:"forestgreen",textColor:"white"});let N=!1;const V=({event:e,args:[t]})=>{A.log("Event received:",t===void 0?{name:e}:{name:e,data:t})};function oe(e){N!==e&&(N=e,e?L(V):l(V))}function ie(...e){N&&A.log(...e)}class se{constructor(){S(this,"listeners",new Map);S(this,"listenersCount",0);S(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(t,...r){this.subscribeListeners.forEach(o=>o({event:t,args:r})),(this.listeners.get(t)||[]).forEach(([o,s])=>{o(...r),s&&this.off(t,o)})}on(t,r,n){let o=this.listeners.get(t);return o||this.listeners.set(t,o=[]),o.push([r,n]),this.listenersCount+=1,()=>this.off(t,r)}off(t,r){const n=this.listeners.get(t)||[];for(let o=0;o<n.length;o+=1)if(r===n[o][0]){n.splice(o,1),this.listenersCount-=1;return}}subscribe(t){return this.subscribeListeners.push(t),()=>this.unsubscribe(t)}unsubscribe(t){for(let r=0;r<this.subscribeListeners.length;r+=1)if(this.subscribeListeners[r]===t){this.subscribeListeners.splice(r,1);return}}}function W(e,t,r){return window.addEventListener(e,t,r),()=>window.removeEventListener(e,t,r)}class b extends Error{constructor(t,r,n){super(r,{cause:n}),this.type=t,Object.setPrototypeOf(this,b.prototype)}}function d(e,t,r){return new b(e,t,r)}const C="ERR_METHOD_UNSUPPORTED",$="ERR_METHOD_PARAMETER_UNSUPPORTED",k="ERR_UNKNOWN_ENV",q="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",G="ERR_TIMED_OUT",H="ERR_UNEXPECTED_TYPE",v="ERR_PARSE",ae="ERR_NAVIGATION_LIST_EMPTY",ce="ERR_NAVIGATION_CURSOR_INVALID",ue="ERR_NAVIGATION_ITEM_INVALID",pe="ERR_SSR_INIT",_e="ERR_SSR_POST_EVENT",fe="ERR_INVALID_PATH_BASE";function w(){return d(H,"Value has unexpected type")}class I{constructor(t,r,n){this.parser=t,this.isOptional=r,this.type=n}parse(t){if(!(this.isOptional&&t===void 0))try{return this.parser(t)}catch(r){throw d(v,`Unable to parse value${this.type?` as ${this.type}`:""}`,r)}}optional(){return this.isOptional=!0,this}}function g(e,t){return()=>new I(e,!1,t)}const h=g(e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;throw w()},"boolean");function j(e,t){const r={};for(const n in e){const o=e[n];if(!o)continue;let s,u;if(typeof o=="function"||"parse"in o)s=n,u=typeof o=="function"?o:o.parse.bind(o);else{const{type:c}=o;s=o.from||n,u=typeof c=="function"?c:c.parse.bind(c)}try{const c=u(t(s));c!==void 0&&(r[n]=c)}catch(c){throw d(v,`Unable to parse field "${n}"`,c)}}return r}function D(e){let t=e;if(typeof t=="string"&&(t=JSON.parse(t)),typeof t!="object"||t===null||Array.isArray(t))throw w();return t}function p(e,t){return new I(r=>{const n=D(r);return j(e,o=>n[o])},!1,t)}const E=g(e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}throw w()},"number");function le(e){return/^#[\da-f]{6}$/i.test(e)}function me(e){return/^#[\da-f]{3}$/i.test(e)}function de(e){const t=e.replace(/\s/g,"").toLowerCase();if(le(t))return t;if(me(t)){let n="#";for(let o=0;o<3;o+=1)n+=t[1+o].repeat(2);return n}const r=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!r)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return r.slice(1).reduce((n,o)=>{const s=parseInt(o,10).toString(16);return n+(s.length===1?"0":"")+s},"#")}const a=g(e=>{if(typeof e=="string"||typeof e=="number")return e.toString();throw w()},"string"),B=g(e=>de(a().parse(e)),"rgb");function he(e){return p({eventType:a(),eventData:t=>t}).parse(e)}function ge(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function Ee(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function be(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((r,n,o)=>{if(n===o.length-1){t[r]=Ee;return}r in t||(t[r]={}),t=t[r]})})}const we=p({button_id:e=>e==null?void 0:a().parse(e)}),ye={clipboard_text_received:p({req_id:a(),data:e=>e===null?e:a().optional().parse(e)}),custom_method_invoked:p({req_id:a(),result:e=>e,error:a().optional()}),invoice_closed:p({slug:a(),status:a()}),phone_requested:p({status:a()}),popup_closed:{parse:e=>we.parse(e??{})},qr_text_received:p({data:a().optional()}),theme_changed:p({theme_params:e=>{const t=B().optional();return Object.entries(D(e)).reduce((r,[n,o])=>(r[n]=t.parse(o),r),{})}}),viewport_changed:p({height:E(),width:e=>e==null?window.innerWidth:E().parse(e),is_state_stable:h(),is_expanded:h()}),write_access_requested:p({status:a()})};function Re(){const e=new se;be();let t=[ge,W("resize",()=>{e.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),W("message",r=>{if(r.source!==window.parent)return;let n;try{n=he(r.data)}catch{return}const{eventType:o,eventData:s}=n,u=ye[o];try{const c=u?u.parse(s):s;e.emit(...c?[o,c]:[o])}catch(c){A.error(`An error occurred processing the "${o}" event from the Telegram application. Please, file an issue here: https://github.com/Telegram-Mini-Apps/tma.js/issues/new/choose`,n,c)}}),()=>e.clear()];return[e,()=>{t.forEach(r=>r()),t=[]}]}const[Te,Pe]=f(e=>{const[t,r]=Re(),n=t.off.bind(t);return t.off=(o,s)=>{const{count:u}=t;n(o,s),u&&!t.count&&e()},[t,r]},([,e])=>e());function T(){return Te()[0]}function Se(e,t){T().off(e,t)}function P(e,t,r){return T().on(e,t,r)}function O(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Ae(e,t){const r=e.split("."),n=t.split("."),o=Math.max(r.length,n.length);for(let s=0;s<o;s+=1){const u=parseInt(r[s]||"0",10),c=parseInt(n[s]||"0",10);if(u!==c)return u>c?1:-1}return 0}function m(e,t){return Ae(e,t)<=0}function M(e,t,r){if(typeof r=="string"){if(e==="web_app_open_link"&&t==="try_instant_view")return m("6.4",r);if(e==="web_app_set_header_color"&&t==="color")return m("6.9",r)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return m("6.1",t);case"web_app_open_popup":return m("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return m("6.4",t);case"web_app_switch_inline_query":return m("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return m("6.9",t);case"web_app_setup_settings_button":return m("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return m("7.2",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function Ne(e){return"external"in e&&O(e.external)&&"notify"in e.external&&typeof e.external.notify=="function"}function K(e){return"TelegramWebviewProxy"in e&&O(e.TelegramWebviewProxy)&&"postEvent"in e.TelegramWebviewProxy&&typeof e.TelegramWebviewProxy.postEvent=="function"}function Y(){try{return window.self!==window.top}catch{return!0}}let J="https://web.telegram.org";function ve(e){J=e}function F(){return J}function y(e,t,r){let n={},o;t===void 0&&r===void 0?n={}:t!==void 0&&r!==void 0?(n=r,o=t):t!==void 0&&("targetOrigin"in t?n=t:o=t);const{targetOrigin:s=F()}=n;if(ie("Posting event:",o?{event:e,data:o}:{event:e}),Y()){window.parent.postMessage(JSON.stringify({eventType:e,eventData:o}),s);return}if(Ne(window)){window.external.notify(JSON.stringify({eventType:e,eventData:o}));return}if(K(window)){window.TelegramWebviewProxy.postEvent(e,JSON.stringify(o));return}throw d(k,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside of Telegram application environment.")}function Ie(e){return(t,r)=>{if(!M(t,e))throw d(C,`Method "${t}" is unsupported in Mini Apps version ${e}`);if(O(r)){let n;if(t==="web_app_open_link"&&"try_instant_view"in r?n="try_instant_view":t==="web_app_set_header_color"&&"color"in r&&(n="color"),n&&!M(t,n,e))throw d($,`Parameter "${n}" of "${t}" method is unsupported in Mini Apps version ${e}`)}return y(t,r)}}function X(e){return({req_id:t})=>t===e}function De(e){return d(G,`Timeout reached: ${e}ms`)}function Oe(e,t){return Promise.race([typeof e=="function"?e():e,new Promise((r,n)=>{setTimeout(()=>{n(De(t))},t)})])}async function U(e){let t;const r=new Promise(R=>{t=R}),{method:n,event:o,capture:s,postEvent:u=y,timeout:c}=e,_=(Array.isArray(o)?o:[o]).map(R=>P(R,re=>(!s||s(re))&&t(re)));try{return u(n,e.params),await(c?Oe(r,c):r)}finally{_.forEach(R=>R())}}async function Me(e,t,r,n={}){const{result:o,error:s}=await U({...n,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:e,params:t,req_id:r},capture:X(r)});if(s)throw d(q,s);return o}async function Ue(){if(K(window))return!0;try{return await U({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function z(e){return e instanceof b}function Le(e,t){return z(e)&&e.type===t}function Ve(e=!0){const t=[P("reload_iframe",()=>{y("iframe_will_reload"),window.location.reload()})],r=()=>t.forEach(n=>n());if(e){const n=document.createElement("style");n.id="telegram-custom-styles",document.head.appendChild(n),t.push(P("set_custom_style",o=>{n.innerHTML=o}),()=>document.head.removeChild(n))}return y("iframe_ready",{reload_supported:!0}),r}const We=g(e=>e instanceof Date?e:new Date(E().parse(e)*1e3),"Date");function Z(e,t){return new I(r=>{if(typeof r!="string"&&!(r instanceof URLSearchParams))throw w();const n=typeof r=="string"?new URLSearchParams(r):r;return j(e,o=>{const s=n.get(o);return s===null?void 0:s})},!1,t)}const Ce=p({id:E(),type:a(),title:a(),photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"Chat").optional(),Q=p({addedToAttachmentMenu:{type:h().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:h().optional(),from:"allows_write_to_pm"},firstName:{type:a(),from:"first_name"},id:E(),isBot:{type:h().optional(),from:"is_bot"},isPremium:{type:h().optional(),from:"is_premium"},languageCode:{type:a().optional(),from:"language_code"},lastName:{type:a().optional(),from:"last_name"},photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"User").optional();function $e(){return Z({authDate:{type:We(),from:"auth_date"},canSendAfter:{type:E().optional(),from:"can_send_after"},chat:Ce,chatInstance:{type:a().optional(),from:"chat_instance"},chatType:{type:a().optional(),from:"chat_type"},hash:a(),queryId:{type:a().optional(),from:"query_id"},receiver:Q,startParam:{type:a().optional(),from:"start_param"},user:Q},"InitData")}function ke(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}function qe(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}const Ge=g(e=>{const t=B().optional();return Object.entries(D(e)).reduce((r,[n,o])=>(r[ke(n)]=t.parse(o),r),{})},"ThemeParams");function x(e){return Z({botInline:{type:h().optional(),from:"tgWebAppBotInline"},initData:{type:$e().optional(),from:"tgWebAppData"},initDataRaw:{type:a().optional(),from:"tgWebAppData"},platform:{type:a(),from:"tgWebAppPlatform"},showSettings:{type:h().optional(),from:"tgWebAppShowSettings"},startParam:{type:a().optional(),from:"tgWebAppStartParam"},themeParams:{type:Ge(),from:"tgWebAppThemeParams"},version:{type:a(),from:"tgWebAppVersion"}}).parse(e)}function ee(e){return x(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function He(){return ee(window.location.href)}function je(){return performance.getEntriesByType("navigation")[0]}function Be(){const e=je();if(!e)throw new Error("Unable to get first navigation entry.");return ee(e.name)}function te(e){return`tma.js/${e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}`}function Ke(e,t){sessionStorage.setItem(te(e),JSON.stringify(t))}function Ye(e){const t=sessionStorage.getItem(te(e));try{return t?JSON.parse(t):void 0}catch{}}function Je(){return x(Ye("launchParams")||"")}function Fe(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,r])=>[qe(t),r])))}function Xe(e){const{initDataRaw:t,themeParams:r,platform:n,version:o,showSettings:s,startParam:u,botInline:c}=e,_=new URLSearchParams;return _.set("tgWebAppPlatform",n),_.set("tgWebAppThemeParams",Fe(r)),_.set("tgWebAppVersion",o),t&&_.set("tgWebAppData",t),u&&_.set("tgWebAppStartParam",u),typeof s=="boolean"&&_.set("tgWebAppShowSettings",s?"1":"0"),typeof c=="boolean"&&_.set("tgWebAppBotInline",c?"1":"0"),_.toString()}function ze(e){Ke("launchParams",Xe(e))}function Ze(){for(const e of[He,Be,Je])try{const t=e();return ze(t),t}catch{}throw new Error("Unable to retrieve launch parameters from any known source.")}return i.ERR_INVALID_PATH_BASE=fe,i.ERR_INVOKE_CUSTOM_METHOD_RESPONSE=q,i.ERR_METHOD_PARAMETER_UNSUPPORTED=$,i.ERR_METHOD_UNSUPPORTED=C,i.ERR_NAVIGATION_HISTORY_EMPTY=ae,i.ERR_NAVIGATION_INDEX_INVALID=ce,i.ERR_NAVIGATION_ITEM_INVALID=ue,i.ERR_PARSE=v,i.ERR_SSR_INIT=pe,i.ERR_SSR_POST_EVENT=_e,i.ERR_TIMED_OUT=G,i.ERR_UNEXPECTED_TYPE=H,i.ERR_UNKNOWN_ENV=k,i.SDKError=b,i.captureSameReq=X,i.createPostEvent=Ie,i.initWeb=Ve,i.invokeCustomMethod=Me,i.isIframe=Y,i.isSDKError=z,i.isSDKErrorOfType=Le,i.isTMA=Ue,i.off=Se,i.on=P,i.postEvent=y,i.request=U,i.retrieveLaunchParams=Ze,i.setDebug=oe,i.setTargetOrigin=ve,i.subscribe=L,i.supports=M,i.targetOrigin=F,i.unsubscribe=l,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),i}({});
//# sourceMappingURL=index.low-level.iife.js.map
